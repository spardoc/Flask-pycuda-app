<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Convolución PyCUDA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet">
</head>
<body class="p-4">
    <h2>Procesamiento de Imagen - DoG</h2>
    <form method="post" enctype="multipart/form-data">
        <input type="hidden" name="method" value="dog">
        <div class="row g-3 align-items-center">
            <!-- Subir imagen -->
            <div class="col-auto">
                <label for="image">Imagen:</label>
                <input class="form-control form-control-sm" type="file" name="image" required>
            </div>

            <!-- Tamaño de máscara -->
            <div class="col-auto">
                <label>Tamaño de Máscara:</label>
                <div class="d-flex flex-wrap">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="mask_option" id="dog_mask9" value="9" checked>
                        <label class="form-check-label" for="dog_mask9">9×9</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="mask_option" id="dog_mask13" value="13">
                        <label class="form-check-label" for="dog_mask13">13×13</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="mask_option" id="dog_mask21" value="21">
                        <label class="form-check-label" for="dog_mask21">21×21</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="mask_option" id="dog_mask_custom" value="custom">
                        <label class="form-check-label" for="dog_mask_custom">Personalizada</label>
                    </div>
                </div>
            </div>

            <!-- Input personalizado -->
            <div id="dog-custom-size-group" class="col-auto" style="display: none;">
                <label for="mask_size">Tamaño:</label>
                <input type="number" name="mask_size" class="form-control form-control-sm" placeholder="ej. 201" min="1" max="501" step="2">
            </div>

            <!-- Modo -->
            <div class="col-auto">
                <label>Modo:</label>
                <select name="mode" class="form-select form-select-sm">
                    <option value="cpu">CPU</option>
                    <option value="gpu">GPU</option>
                </select>
            </div>

            <!-- Botón -->
            <div class="col-auto">
                <button class="btn btn-primary">Procesar DoG</button>
            </div>
        </div>
    </form>

    {% if stats and "dog" in output_image %}
    <hr>
    <div class="row">
        <div class="col-md-6">
            <h5>Original</h5>
            <img src="{{ input_image }}" class="img-fluid">
        </div>
        <div class="col-md-6">
            <h5>Procesada (DoG)</h5>
            <img src="{{ output_image }}" class="img-fluid">
        </div>
    </div>
    <div class="mt-3">
        <h5>Estadísticas:</h5>
        <ul>
            <li>Modo: {{ stats.mode }}</li>
            <li>Tamaño máscara: {{ stats.mask_size }}</li>
            {% if stats.mode == 'GPU' %}
            <li>Hilos por bloque: {{ stats.threads }}</li>
            <li>Bloques: {{ stats.blocks }}</li>
            {% endif %}
            <li>Tiempo (s): {{ stats.time_s | round(4) }}</li>
        </ul>
    </div>
    {% endif %}

    <hr class="my-5">

    <h2>Procesamiento de Imagen - Motion Blur</h2>
    <form method="post" enctype="multipart/form-data">
        <input type="hidden" name="method" value="motion">
        <div class="row g-3 align-items-center">
            <!-- Subir imagen -->
            <div class="col-auto">
                <label for="image">Imagen:</label>
                <input class="form-control form-control-sm" type="file" name="image" required>
            </div>

            <!-- Tamaño de máscara -->
            <div class="col-auto">
                <label>Tamaño de Máscara:</label>
                <div class="d-flex flex-wrap">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="mask_option" id="motion_mask9" value="9" checked>
                        <label class="form-check-label" for="motion_mask9">9×9</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="mask_option" id="motion_mask13" value="13">
                        <label class="form-check-label" for="motion_mask13">13×13</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="mask_option" id="motion_mask21" value="21">
                        <label class="form-check-label" for="motion_mask21">21×21</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="mask_option" id="motion_mask_custom" value="custom">
                        <label class="form-check-label" for="motion_mask_custom">Personalizada</label>
                    </div>
                </div>
            </div>

            <!-- Input personalizado -->
            <div id="motion-custom-size-group" class="col-auto" style="display: none;">
                <label for="mask_size">Tamaño:</label>
                <input type="number" name="mask_size" class="form-control form-control-sm" placeholder="ej. 201" min="1" max="501" step="2">
            </div>

            <!-- Modo -->
            <div class="col-auto">
                <label>Modo:</label>
                <select name="mode" class="form-select form-select-sm">
                    <option value="cpu">CPU</option>
                    <option value="gpu">GPU</option>
                </select>
            </div>

            <!-- Botón -->
            <div class="col-auto">
                <button class="btn btn-primary">Procesar Motion Blur</button>
            </div>
        </div>
    </form>

    {% if stats and "motion" in output_image %}
    <hr>
    <div class="row">
        <div class="col-md-6">
            <h5>Original</h5>
            <img src="{{ input_image }}" class="img-fluid">
        </div>
        <div class="col-md-6">
            <h5>Procesada (Motion Blur)</h5>
            <img src="{{ output_image }}" class="img-fluid">
        </div>
    </div>
    <div class="mt-3">
        <h5>Estadísticas:</h5>
        <ul>
            <li>Modo: {{ stats.mode }}</li>
            <li>Tamaño máscara: {{ stats.mask_size }}</li>
            {% if stats.mode == 'GPU' %}
            <li>Hilos por bloque: {{ stats.threads }}</li>
            <li>Bloques: {{ stats.blocks }}</li>
            {% endif %}
            <li>Tiempo (s): {{ stats.time_s | round(4) }}</li>
        </ul>
    </div>
    {% endif %}

    <script>
        // Mostrar input personalizado para DoG
        const dogRadios = document.querySelectorAll('input[name="mask_option"]');
        const dogCustomGroup = document.getElementById('dog-custom-size-group');
        dogRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.id.startsWith("dog_")) {
                    if (radio.value === 'custom' && radio.checked) {
                        dogCustomGroup.style.display = 'flex';
                    } else if (radio.checked) {
                        dogCustomGroup.style.display = 'none';
                        dogCustomGroup.querySelector('input').value = '';
                    }
                }
            });
        });

        // Mostrar input personalizado para Motion
        const motionRadios = document.querySelectorAll('input[name="mask_option"]');
        const motionCustomGroup = document.getElementById('motion-custom-size-group');
        motionRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.id.startsWith("motion_")) {
                    if (radio.value === 'custom' && radio.checked) {
                        motionCustomGroup.style.display = 'flex';
                    } else if (radio.checked) {
                        motionCustomGroup.style.display = 'none';
                        motionCustomGroup.querySelector('input').value = '';
                    }
                }
            });
        });
    </script>
</body>
</html>