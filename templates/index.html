<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Convolución PyCUDA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet">
</head>
<body class="p-4">
    <h1>Convolución de Imagen</h1>
    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" class="row gx-2 gy-3 align-items-end">
    <!-- Imagen -->
    <div class="col-auto">
        <label>Imagen:</label>
        <input type="file" name="image" class="form-control" required>
    </div>

    <!-- Tamaño de máscara -->
    <div class="col-auto">
        <label>Tamaño de Máscara:</label>
        <div class="d-flex">
            <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="mask_option"
                    id="mask9" value="9" checked>
            <label class="form-check-label" for="mask9">9×9</label>
            </div>
            <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="mask_option"
                    id="mask13" value="13">
            <label class="form-check-label" for="mask13">13×13</label>
            </div>
            <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="mask_option"
                    id="mask21" value="21">
            <label class="form-check-label" for="mask21">21×21</label>
            </div>
            <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="mask_option"
                    id="mask_custom" value="custom">
            <label class="form-check-label" for="mask_custom">Personalizada</label>
            </div>
        </div>
    </div>

    <!-- Input personalizado (oculto por defecto) -->
    <div id="custom-size-group" class="col-auto" style="display: none;">
        <label for="mask_size">Tamaño:</label>
        <input type="number"
            name="mask_size"
            id="mask_size"
            class="form-control form-control-sm"
            placeholder="ej. 201"
            min="1"
            max="501"
            step="2">
    </div>

    <!-- Modo -->
    <div class="col-auto">
        <label>Modo:</label>
        <select name="mode" class="form-select form-select-sm">
        <option value="cpu">CPU</option>
        <option value="gpu">GPU</option>
        </select>
    </div>

    <!-- Botón -->
    <div class="col-auto">
        <button class="btn btn-primary">Procesar</button>
    </div>
</form>

{% if input_image %}
    <hr>
    <div class="row">
    <div class="col-md-6">
        <h5>Original</h5>
        <img src="{{ input_image }}" class="img-fluid">
    </div>
    <div class="col-md-6">
        <h5>Procesada (DoG)</h5>
        <img src="{{ output_image }}" class="img-fluid">
    </div>
    </div>
    <div class="mt-3">
    <h5>Estadísticas:</h5>
    <ul>
        <li>Modo: {{ stats.mode }}</li>
        <li>Tamaño máscara: {{ stats.mask_size }}</li>
        {% if stats.mode == 'GPU' %}
        <li>Hilos por bloque: {{ stats.threads }}</li>
        <li>Bloques: {{ stats.blocks }}</li>
        {% endif %}
        <li>Tiempo (s): {{ stats.time_s | round(4) }}</li>
    </ul>
    </div>
{% endif %}

<script>
    // Muestra/oculta el input de tamaño personalizado
    const radios = document.querySelectorAll('input[name="mask_option"]');
    const customGroup = document.getElementById('custom-size-group');
    radios.forEach(radio => {
        radio.addEventListener('change', () => {
        if (radio.value === 'custom' && radio.checked) {
            customGroup.style.display = 'flex';
        } else if (radio.checked) {
            customGroup.style.display = 'none';
            customGroup.querySelector('input').value = '';
        }
        });
    });
</script>
</body>
</html>
